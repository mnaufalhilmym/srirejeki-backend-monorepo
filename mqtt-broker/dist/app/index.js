"use strict";var __awaiter=this&&this.__awaiter||function(e,a,i,s){return new(i=i||Promise)(function(t,n){function o(e){try{c(s.next(e))}catch(e){n(e)}}function r(e){try{c(s.throw(e))}catch(e){n(e)}}function c(e){var n;e.done?t(e.value):((n=e.value)instanceof i?n:new i(function(e){e(n)})).then(o,r)}c((s=s.apply(e,a||[])).next())})},__generator=this&&this.__generator||function(o,r){var c,a,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:n(0),throw:n(1),return:n(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function n(t){return function(e){var n=[t,e];if(c)throw new TypeError("Generator is already executing.");for(;s;)try{if(c=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,(n=i?[2&n[0],i.value]:n)[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=r.call(o,s)}catch(e){n=[6,e],a=0}finally{c=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}}},__importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},aedes_1=(Object.defineProperty(exports,"__esModule",{value:!0}),exports.port=void 0,__importDefault(require("aedes"))),net_1=__importDefault(require("net")),authenticate=function(e,n,t,o){var r;if(e)return"78e36d093868"!==e.id?((r=new Error("Client id ".concat(e.id," is not registered"))).returnCode=5,console.error(r.message),void o(r,!1)):(console.info("Client id ".concat(e.id," connection accepted")),void o(null,!0));(r=new Error("Client not provide it's identifier")).returnCode=5,console.error(r.message),o(r,!1)},aedesInstance=(0,aedes_1.default)({authenticate:authenticate}),server=net_1.default.createServer(aedesInstance.handle),port=(aedesInstance.on("client",function(e){console.log("[CLIENT_CONNECTED] Client ".concat(e&&e.id," connected to broker ").concat(aedesInstance.id))}),aedesInstance.on("clientDisconnect",function(e){console.log("[CLIENT_DISCONNECTED] Client ".concat(e&&e.id," disconnected from the broker ").concat(aedesInstance.id))}),aedesInstance.on("subscribe",function(e,n){console.log("[TOPIC_SUBSCRIBED] Client ".concat(n&&n.id," subscribed to topics: ").concat(e.map(function(e){return e.topic}).join(",")," on broker ").concat(aedesInstance.id))}),aedesInstance.on("unsubscribe",function(e,n){console.log("[TOPIC_UNSUBSCRIBED] Client ".concat(n&&n.id," unsubscribed to topics: ").concat(e.join(",")," from broker ").concat(aedesInstance.id))}),aedesInstance.on("publish",function(n,t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return t&&console.log("[MESSAGE_PUBLISHED] Client ".concat(t?t.id:"BROKER_"+aedesInstance.id," has published message ").concat(n.payload," on ").concat(n.topic," to broker ").concat(aedesInstance.id)),[2]})})}),process.env.PORT||1883);exports.port=port,exports.default=server;